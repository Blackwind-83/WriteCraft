import { __awaiter } from "tslib";
export class ConceptViewProcessor {
    constructor(plugin) {
        this.plugin = plugin;
    }
    load() {
        this.plugin.registerPriorityMarkdownPostProcessor(-100, (el, ctx) => __awaiter(this, void 0, void 0, function* () {
            const sectionInfo = ctx.getSectionInfo(el);
            if (!sectionInfo) {
                return;
            }
            // Log pour vérifier si l'élément contient un bloc "organigrame"
            console.log("Markdown Element:", el.getHTML());
            const codeBlock = el.innerText;
            console.log("Code Block Content:", codeBlock);
            const content = codeBlock.trim();
            console.log("content Extracted:", content);
            // Génère le HTML interactif
            const div = document.createElement("div");
            div.className = "writecraft-overlay"; // Classe pour styliser
            div.innerHTML = this.generateInteractiveHTML(content);
            // Ajoute la superposition au DOM
            el.style.position = "relative"; // Nécessaire pour positionner la superposition
            el.innerHTML = "";
            el.appendChild(div);
        }));
    }
    /**
      * Génère du HTML interactif à partir du contenu Markdown.
      */
    generateInteractiveHTML(content) {
        const lines = content
            .split("\n")
            .map((line) => line.trim())
            .filter((line) => line);
        let html = content; //"<div class='fiche-personnage'>";
        console.log("--------");
        lines.forEach((line) => {
            const field = this.parseField(line);
            if (field) {
                const result = this.renderField(field);
                console.log("###### " + line + "=> " + field.type);
                console.log("## AVANT : " + +html);
                console.log("############################" + field.type);
                if (field.type != "link") {
                    html = html.replace(line, result);
                }
                console.log("## APRES : " + +html);
            }
        });
        console.log("--------");
        //html += "</div>";
        return html;
    }
    /**
     * Analyse une ligne Markdown et retourne un objet Field correspondant.
     */
    parseField(line) {
        // Radio
        console.log("parseField=>" + line);
        const radioMatch = line.match(/(\w+)\((.+?)\): ?(.*)/);
        if (radioMatch) {
            return {
                type: "radio",
                name: radioMatch[1],
                options: radioMatch[2].split(",").map((o) => o.trim()),
                value: radioMatch[3].trim(),
            };
        }
        // Checkbox
        const checkboxMatch = line.match(/(\w+)\[(.+?)\]: ?(.*)/);
        if (checkboxMatch) {
            return {
                type: "checkbox",
                name: checkboxMatch[1],
                options: checkboxMatch[2].split(",").map((o) => o.trim()),
                values: checkboxMatch[3].split(",").map((o) => o.trim()),
            };
        }
        // Combobox
        const comboboxMatch = line.match(/(\w+)\{(.+?)\}: ?(.*)/);
        if (comboboxMatch) {
            return {
                type: "combobox",
                name: comboboxMatch[1],
                options: comboboxMatch[2].split(",").map((o) => o.trim()),
                value: comboboxMatch[3].trim(),
            };
        }
        // Link
        const linkMatch = line.match(/(\w+): \[\[(.+?)\]\]/);
        if (linkMatch) {
            console.log("LinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLinkLink");
            return {
                type: "link",
                name: linkMatch[1],
                value: linkMatch[2],
            };
        }
        // Number
        const numberMatch = line.match(/(\w+): ?(\d+)/);
        console.log("NumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumberNumber");
        if (numberMatch) {
            return {
                type: "number",
                name: numberMatch[1],
                value: parseInt(numberMatch[2], 10),
            };
        }
        // Date
        const dateMatch = line.match(/(\w+): ?(\d{4}-\d{2}-\d{2})/);
        if (dateMatch) {
            console.log("DateDateDateDateDateDateDateDateDateDateDateDateDateDateDateDateDateDateDateDate");
            return {
                type: "date",
                name: dateMatch[1],
                value: dateMatch[2],
            };
        }
        // String
        const stringMatch = line.match(/(\w+): ?(.*)/);
        if (stringMatch) {
            console.log("StringStringStringStringStringStringStringStringStringStringStringStringStringStringStringStringString");
            return {
                type: "string",
                name: stringMatch[1],
                value: stringMatch[2].trim(),
            };
        }
        return null;
    }
    /**
     * Rend un champ HTML en fonction de son type.
     */
    renderField(field) {
        console.log("renderField=>" + field.type);
        switch (field.type) {
            case "radio":
                return `
                <p><strong>${field.name} :</strong>
                    ${field.options
                    .map((option) => `<label>
                                    <input type="radio" name="${field.name}" value="${option}" ${option === field.value ? "checked" : ""} /> ${option}
                                </label>`)
                    .join("")}
                </p>
            `;
            case "checkbox":
                return `
                <p><strong>${field.name} :</strong>
                    ${field.options
                    .map((option) => `<label>
                                    <input type="checkbox" name="${field.name}" value="${option}" ${field.values.includes(option) ? "checked" : ""} /> ${option}
                                </label>`)
                    .join("")}
                </p>
            `;
            case "combobox":
                return `
                <p><strong>${field.name} :</strong>
                    <select name="${field.name}">
                        ${field.options
                    .map((option) => `<option value="${option}" ${option === field.value ? "selected" : ""}>${option}</option>`)
                    .join("")}
                    </select>
                </p>
            `;
            case "string":
                return `
                <p><strong>${field.name} :</strong>
                    <input type="text" name="${field.name}" value="${field.value}" />
                </p>
            `;
            case "number":
                return `
                <p><strong>${field.name} :</strong>
                    <input type="number" name="${field.name}" value="${field.value}" />
                </p>
            `;
            case "date":
                return `
                <p><strong>${field.name} :</strong>
                    <input type="date" name="${field.name}" value="${field.value}" />
                </p>
            `;
            case "link":
                return `
                <p><strong>${field.name} :</strong>
                    <a href="${field.value}" target="_blank">${field.value}</a>
                </p>
            `;
            default:
                return "";
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uY2VwdFZpZXdQcm9jZXNzb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWFya2Rvd24vQ29uY2VwdFZpZXdQcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQStEQSxNQUFNLE9BQU8sb0JBQW9CO0lBRzdCLFlBQVksTUFBbUI7UUFDM0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDekIsQ0FBQztJQUVELElBQUk7UUFDQSxJQUFJLENBQUMsTUFBTSxDQUFDLHFDQUFxQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQU8sRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFO1lBQ3RFLE1BQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFM0MsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNmLE9BQU07WUFDVixDQUFDO1lBRUQsZ0VBQWdFO1lBQ2hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFFL0MsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRTNDLDRCQUE0QjtZQUM1QixNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsb0JBQW9CLENBQUMsQ0FBQyx1QkFBdUI7WUFDN0QsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFdEQsaUNBQWlDO1lB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QUk7K0NBQ1EsS0FBSyxDQUFDLElBQUksWUFBWSxLQUFLLENBQUMsS0FBSzs7YUFFbkUsQ0FBQztZQUNGLEtBQUssUUFBUTtnQkFDVCxPQUFPOzZCQUNNLEtBQUssQ0FBQyxJQUFJO2lEQUNVLEtBQUssQ0FBQyxJQUFJLFlBQVksS0FBSyxDQUFDLEtBQUs7O2FBRXJFLENBQUM7WUFDRixLQUFLLE1BQU07Z0JBQ1AsT0FBTzs2QkFDTSxLQUFLLENBQUMsSUFBSTsrQ0FDUSxLQUFLLENBQUMsSUFBSSxZQUFZLEtBQUssQ0FBQyxLQUFLOzthQUVuRSxDQUFDO1lBRUYsS0FBSyxNQUFNO2dCQUNQLE9BQU87NkJBQ00sS0FBSyxDQUFDLElBQUk7K0JBQ1IsS0FBSyxDQUFDLEtBQUsscUJBQXFCLEtBQUssQ0FBQyxLQUFLOzthQUU3RCxDQUFDO1lBQ0Y7Z0JBQ0ksT0FBTyxFQUFFLENBQUM7UUFDbEIsQ0FBQztJQUNMLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOb3ZlbFBsdWdpbiBmcm9tIFwic3JjL21haW5cIjtcclxuXHJcbi8vIEludGVyZmFjZSBwb3VyIHVuIGNoYW1wIGfDqW7DqXJpcXVlXHJcbmludGVyZmFjZSBCYXNlRmllbGQge1xyXG4gICAgdHlwZTogc3RyaW5nOyAvLyBUeXBlIGfDqW7DqXJpcXVlIChzdHJpbmcsIHJhZGlvLCBjaGVja2JveCwgZXRjLilcclxuICAgIG5hbWU6IHN0cmluZzsgLy8gTm9tIGRlIGwnYXR0cmlidXQgKGV4OiBcInNleGVcIiwgXCJwcsOpbm9tXCIpXHJcbn1cclxuXHJcbi8vIENoYW1wcyByYWRpbyAoY2hvaXggdW5pcXVlKVxyXG5pbnRlcmZhY2UgUmFkaW9GaWVsZCBleHRlbmRzIEJhc2VGaWVsZCB7XHJcbiAgICB0eXBlOiBcInJhZGlvXCI7XHJcbiAgICBvcHRpb25zOiBzdHJpbmdbXTtcclxuICAgIHZhbHVlOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8vIENoYW1wcyBjaGVja2JveCAoY2hvaXggbXVsdGlwbGVzKVxyXG5pbnRlcmZhY2UgQ2hlY2tib3hGaWVsZCBleHRlbmRzIEJhc2VGaWVsZCB7XHJcbiAgICB0eXBlOiBcImNoZWNrYm94XCI7XHJcbiAgICBvcHRpb25zOiBzdHJpbmdbXTtcclxuICAgIHZhbHVlczogc3RyaW5nW107XHJcbn1cclxuXHJcbi8vIENoYW1wcyBjb21ib2JveCAobWVudSBkw6lyb3VsYW50KVxyXG5pbnRlcmZhY2UgQ29tYm9ib3hGaWVsZCBleHRlbmRzIEJhc2VGaWVsZCB7XHJcbiAgICB0eXBlOiBcImNvbWJvYm94XCI7XHJcbiAgICBvcHRpb25zOiBzdHJpbmdbXTtcclxuICAgIHZhbHVlOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8vIENoYW1wIHRleHRlXHJcbmludGVyZmFjZSBTdHJpbmdGaWVsZCBleHRlbmRzIEJhc2VGaWVsZCB7XHJcbiAgICB0eXBlOiBcInN0cmluZ1wiO1xyXG4gICAgdmFsdWU6IHN0cmluZztcclxufVxyXG5cclxuLy8gQ2hhbXAgbnVtw6lyaXF1ZVxyXG5pbnRlcmZhY2UgTnVtYmVyRmllbGQgZXh0ZW5kcyBCYXNlRmllbGQge1xyXG4gICAgdHlwZTogXCJudW1iZXJcIjtcclxuICAgIHZhbHVlOiBudW1iZXI7XHJcbn1cclxuXHJcbi8vIENoYW1wIGRhdGVcclxuaW50ZXJmYWNlIERhdGVGaWVsZCBleHRlbmRzIEJhc2VGaWVsZCB7XHJcbiAgICB0eXBlOiBcImRhdGVcIjtcclxuICAgIHZhbHVlOiBzdHJpbmc7IC8vIEZvcm1hdCBZWVlZLU1NLUREXHJcbn1cclxuXHJcbi8vIENoYW1wIGxpZW5cclxuaW50ZXJmYWNlIExpbmtGaWVsZCBleHRlbmRzIEJhc2VGaWVsZCB7XHJcbiAgICB0eXBlOiBcImxpbmtcIjtcclxuICAgIHZhbHVlOiBzdHJpbmc7IC8vIFZhbGV1ciBkdSBsaWVuIChleDogXCJOZXcgWW9ya1wiKVxyXG59XHJcblxyXG4vLyBVbmlvbiBkZSB0b3VzIGxlcyB0eXBlcyBkZSBjaGFtcHNcclxudHlwZSBGaWVsZCA9XHJcbiAgICB8IFJhZGlvRmllbGRcclxuICAgIHwgQ2hlY2tib3hGaWVsZFxyXG4gICAgfCBDb21ib2JveEZpZWxkXHJcbiAgICB8IFN0cmluZ0ZpZWxkXHJcbiAgICB8IE51bWJlckZpZWxkXHJcbiAgICB8IERhdGVGaWVsZFxyXG4gICAgfCBMaW5rRmllbGQ7XHJcblxyXG5leHBvcnQgY2xhc3MgQ29uY2VwdFZpZXdQcm9jZXNzb3Ige1xyXG4gICAgcHJpdmF0ZSBwbHVnaW46IE5vdmVsUGx1Z2luO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHBsdWdpbjogTm92ZWxQbHVnaW4pIHtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkKCkge1xyXG4gICAgICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyUHJpb3JpdHlNYXJrZG93blBvc3RQcm9jZXNzb3IoLTEwMCwgYXN5bmMgKGVsLCBjdHgpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc2VjdGlvbkluZm8gPSBjdHguZ2V0U2VjdGlvbkluZm8oZWwpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFzZWN0aW9uSW5mbykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvZyBwb3VyIHbDqXJpZmllciBzaSBsJ8OpbMOpbWVudCBjb250aWVudCB1biBibG9jIFwib3JnYW5pZ3JhbWVcIlxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hcmtkb3duIEVsZW1lbnQ6XCIsIGVsLmdldEhUTUwoKSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjb2RlQmxvY2sgPSBlbC5pbm5lclRleHQ7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29kZSBCbG9jayBDb250ZW50OlwiLCBjb2RlQmxvY2spO1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gY29kZUJsb2NrLnRyaW0oKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb250ZW50IEV4dHJhY3RlZDpcIiwgY29udGVudCk7XHJcblxyXG4gICAgICAgICAgICAvLyBHw6luw6hyZSBsZSBIVE1MIGludGVyYWN0aWZcclxuICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9IFwid3JpdGVjcmFmdC1vdmVybGF5XCI7IC8vIENsYXNzZSBwb3VyIHN0eWxpc2VyXHJcbiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSB0aGlzLmdlbmVyYXRlSW50ZXJhY3RpdmVIVE1MKGNvbnRlbnQpO1xyXG5cclxuICAgICAgICAgICAgLy8gQWpvdXRlIGxhIHN1cGVycG9zaXRpb24gYXUgRE9NXHJcbiAgICAgICAgICAgIGVsLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiOyAvLyBOw6ljZXNzYWlyZSBwb3VyIHBvc2l0aW9ubmVyIGxhIHN1cGVycG9zaXRpb25cclxuICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgICogR8OpbsOocmUgZHUgSFRNTCBpbnRlcmFjdGlmIMOgIHBhcnRpciBkdSBjb250ZW51IE1hcmtkb3duLlxyXG4gICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZW5lcmF0ZUludGVyYWN0aXZlSFRNTChjb250ZW50OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IGxpbmVzID0gY29udGVudFxyXG4gICAgICAgICAgICAuc3BsaXQoXCJcXG5cIilcclxuICAgICAgICAgICAgLm1hcCgobGluZSkgPT4gbGluZS50cmltKCkpXHJcbiAgICAgICAgICAgIC5maWx0ZXIoKGxpbmUpID0+IGxpbmUpO1xyXG5cclxuICAgICAgICBsZXQgaHRtbCA9IGNvbnRlbnQgLy9cIjxkaXYgY2xhc3M9J2ZpY2hlLXBlcnNvbm5hZ2UnPlwiO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiLS0tLS0tLS1cIilcclxuICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5wYXJzZUZpZWxkKGxpbmUpO1xyXG4gICAgICAgICAgICBpZiAoZmllbGQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVuZGVyRmllbGQoZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIjIyMjIyMgXCIgKyBsaW5lICsgXCI9PiBcIiArIGZpZWxkLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIjIyBBVkFOVCA6IFwiICsgKyAgaHRtbClcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1wiICsgZmllbGQudHlwZSlcclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlICE9IFwibGlua1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShsaW5lLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIjIyBBUFJFUyA6IFwiICsgKyAgaHRtbClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiLS0tLS0tLS1cIilcclxuICAgICAgICAvL2h0bWwgKz0gXCI8L2Rpdj5cIjtcclxuXHJcbiAgICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBbmFseXNlIHVuZSBsaWduZSBNYXJrZG93biBldCByZXRvdXJuZSB1biBvYmpldCBGaWVsZCBjb3JyZXNwb25kYW50LlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHBhcnNlRmllbGQobGluZTogc3RyaW5nKTogRmllbGQgfCBudWxsIHtcclxuICAgICAgICAvLyBSYWRpb1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcInBhcnNlRmllbGQ9PlwiICsgbGluZSk7XHJcbiAgICAgICAgY29uc3QgcmFkaW9NYXRjaCA9IGxpbmUubWF0Y2goLyhcXHcrKVxcKCguKz8pXFwpOiA/KC4qKS8pO1xyXG4gICAgICAgIGlmIChyYWRpb01hdGNoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcInJhZGlvXCIsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiByYWRpb01hdGNoWzFdLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogcmFkaW9NYXRjaFsyXS5zcGxpdChcIixcIikubWFwKChvKSA9PiBvLnRyaW0oKSksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogcmFkaW9NYXRjaFszXS50cmltKCksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVja2JveFxyXG4gICAgICAgIGNvbnN0IGNoZWNrYm94TWF0Y2ggPSBsaW5lLm1hdGNoKC8oXFx3KylcXFsoLis/KVxcXTogPyguKikvKTtcclxuICAgICAgICBpZiAoY2hlY2tib3hNYXRjaCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogY2hlY2tib3hNYXRjaFsxXSxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IGNoZWNrYm94TWF0Y2hbMl0uc3BsaXQoXCIsXCIpLm1hcCgobykgPT4gby50cmltKCkpLFxyXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBjaGVja2JveE1hdGNoWzNdLnNwbGl0KFwiLFwiKS5tYXAoKG8pID0+IG8udHJpbSgpKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbWJvYm94XHJcbiAgICAgICAgY29uc3QgY29tYm9ib3hNYXRjaCA9IGxpbmUubWF0Y2goLyhcXHcrKVxceyguKz8pXFx9OiA/KC4qKS8pO1xyXG4gICAgICAgIGlmIChjb21ib2JveE1hdGNoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcImNvbWJvYm94XCIsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBjb21ib2JveE1hdGNoWzFdLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogY29tYm9ib3hNYXRjaFsyXS5zcGxpdChcIixcIikubWFwKChvKSA9PiBvLnRyaW0oKSksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogY29tYm9ib3hNYXRjaFszXS50cmltKCksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMaW5rXHJcbiAgICAgICAgY29uc3QgbGlua01hdGNoID0gbGluZS5tYXRjaCgvKFxcdyspOiBcXFtcXFsoLis/KVxcXVxcXS8pO1xyXG4gICAgICAgIGlmIChsaW5rTWF0Y2gpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rTGlua0xpbmtMaW5rXCIpXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcImxpbmtcIixcclxuICAgICAgICAgICAgICAgIG5hbWU6IGxpbmtNYXRjaFsxXSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBsaW5rTWF0Y2hbMl0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBOdW1iZXJcclxuICAgICAgICBjb25zdCBudW1iZXJNYXRjaCA9IGxpbmUubWF0Y2goLyhcXHcrKTogPyhcXGQrKS8pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyTnVtYmVyXCIpXHJcbiAgICAgICAgaWYgKG51bWJlck1hdGNoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogbnVtYmVyTWF0Y2hbMV0sXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogcGFyc2VJbnQobnVtYmVyTWF0Y2hbMl0sIDEwKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERhdGVcclxuICAgICAgICBjb25zdCBkYXRlTWF0Y2ggPSBsaW5lLm1hdGNoKC8oXFx3Kyk6ID8oXFxkezR9LVxcZHsyfS1cXGR7Mn0pLyk7XHJcbiAgICAgICAgaWYgKGRhdGVNYXRjaCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRhdGVEYXRlRGF0ZURhdGVEYXRlRGF0ZURhdGVEYXRlRGF0ZURhdGVEYXRlRGF0ZURhdGVEYXRlRGF0ZURhdGVEYXRlRGF0ZURhdGVEYXRlXCIpXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcImRhdGVcIixcclxuICAgICAgICAgICAgICAgIG5hbWU6IGRhdGVNYXRjaFsxXSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBkYXRlTWF0Y2hbMl0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdHJpbmdcclxuICAgICAgICBjb25zdCBzdHJpbmdNYXRjaCA9IGxpbmUubWF0Y2goLyhcXHcrKTogPyguKikvKTtcclxuICAgICAgICBpZiAoc3RyaW5nTWF0Y2gpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdTdHJpbmdcIilcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBzdHJpbmdNYXRjaFsxXSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBzdHJpbmdNYXRjaFsyXS50cmltKCksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbmQgdW4gY2hhbXAgSFRNTCBlbiBmb25jdGlvbiBkZSBzb24gdHlwZS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZW5kZXJGaWVsZChmaWVsZDogRmllbGQpOiBzdHJpbmcge1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcInJlbmRlckZpZWxkPT5cIiArIGZpZWxkLnR5cGUpO1xyXG4gICAgICAgIHN3aXRjaCAoZmllbGQudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwicmFkaW9cIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBgXHJcbiAgICAgICAgICAgICAgICA8cD48c3Ryb25nPiR7ZmllbGQubmFtZX0gOjwvc3Ryb25nPlxyXG4gICAgICAgICAgICAgICAgICAgICR7ZmllbGQub3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKG9wdGlvbikgPT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGxhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cIiR7ZmllbGQubmFtZX1cIiB2YWx1ZT1cIiR7b3B0aW9ufVwiICR7b3B0aW9uID09PSBmaWVsZC52YWx1ZSA/IFwiY2hlY2tlZFwiIDogXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gLz4gJHtvcHRpb259XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmpvaW4oXCJcIil9XHJcbiAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgIGA7XHJcbiAgICAgICAgICAgIGNhc2UgXCJjaGVja2JveFwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGBcclxuICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+JHtmaWVsZC5uYW1lfSA6PC9zdHJvbmc+XHJcbiAgICAgICAgICAgICAgICAgICAgJHtmaWVsZC5vcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAob3B0aW9uKSA9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8bGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwiJHtmaWVsZC5uYW1lfVwiIHZhbHVlPVwiJHtvcHRpb259XCIgJHtmaWVsZC52YWx1ZXMuaW5jbHVkZXMob3B0aW9uKSA/IFwiY2hlY2tlZFwiIDogXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gLz4gJHtvcHRpb259XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmpvaW4oXCJcIil9XHJcbiAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgIGA7XHJcbiAgICAgICAgICAgIGNhc2UgXCJjb21ib2JveFwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGBcclxuICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+JHtmaWVsZC5uYW1lfSA6PC9zdHJvbmc+XHJcbiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBuYW1lPVwiJHtmaWVsZC5uYW1lfVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAke2ZpZWxkLm9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvcHRpb24pID0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9XCIke29wdGlvbn1cIiAke29wdGlvbiA9PT0gZmllbGQudmFsdWUgPyBcInNlbGVjdGVkXCIgOiBcIlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfT4ke29wdGlvbn08L29wdGlvbj5gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmpvaW4oXCJcIil9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+XHJcbiAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgIGA7XHJcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBgXHJcbiAgICAgICAgICAgICAgICA8cD48c3Ryb25nPiR7ZmllbGQubmFtZX0gOjwvc3Ryb25nPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIG5hbWU9XCIke2ZpZWxkLm5hbWV9XCIgdmFsdWU9XCIke2ZpZWxkLnZhbHVlfVwiIC8+XHJcbiAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgIGA7XHJcbiAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBgXHJcbiAgICAgICAgICAgICAgICA8cD48c3Ryb25nPiR7ZmllbGQubmFtZX0gOjwvc3Ryb25nPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwibnVtYmVyXCIgbmFtZT1cIiR7ZmllbGQubmFtZX1cIiB2YWx1ZT1cIiR7ZmllbGQudmFsdWV9XCIgLz5cclxuICAgICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgYDtcclxuICAgICAgICAgICAgY2FzZSBcImRhdGVcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBgXHJcbiAgICAgICAgICAgICAgICA8cD48c3Ryb25nPiR7ZmllbGQubmFtZX0gOjwvc3Ryb25nPlxyXG4gICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiZGF0ZVwiIG5hbWU9XCIke2ZpZWxkLm5hbWV9XCIgdmFsdWU9XCIke2ZpZWxkLnZhbHVlfVwiIC8+XHJcbiAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgIGA7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFwibGlua1wiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGBcclxuICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+JHtmaWVsZC5uYW1lfSA6PC9zdHJvbmc+XHJcbiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cIiR7ZmllbGQudmFsdWV9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHtmaWVsZC52YWx1ZX08L2E+XHJcbiAgICAgICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICAgIGA7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=